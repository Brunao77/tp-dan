global
  log /dev/log    local0
  log /dev/log    local1 notice
  maxconn 4096

defaults
  log global
  mode http
  option httplog
  option dontlognull
  timeout connect 5000
  timeout client 50000
  timeout server 50000

listen stats
  bind 0.0.0.0:70
  mode http
  stats enable
  stats hide-version
  stats scope .
  stats realm Haproxy\ Statistics
  stats uri /
  stats auth user:pass

frontend http-in
  stats enable
  stats auth user:pass
  stats uri /haproxy?stats
  bind 0.0.0.0:80
  mode http
  
  # ACLs para las rutas de la API - estas deben ir al gateway
  acl clientes_back path_beg /clientes
  acl productos_back path_beg /productos
  acl pedidos_back path_beg /pedidos
  acl api_back path_beg /api
  
  # Rutas hacia los backends (orden importa: más específicas primero)
  use_backend dan_gateway if clientes_back
  use_backend dan_gateway if productos_back
  use_backend dan_gateway if pedidos_back
  use_backend dan_gateway if api_back
  
  # Por defecto, cualquier otra ruta va al frontend Next.js
  default_backend danui

backend danui
    server ui-app dan-ui:3000 check

backend dan_gateway
    # Todas las rutas de API van al gateway que redistribuye a los microservicios
    server gateway ms-gateway-svc:8080 check
